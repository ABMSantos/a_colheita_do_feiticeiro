<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>A Colheita do Feiticeiro</title>
<style>
  body { margin:0; display:flex; justify-content:center; align-items:center; height:100vh; background:#000; }
  canvas { display:block; margin:auto; }
</style>
</head>
<body>
<script type="module">
import kaboom from "https://unpkg.com/kaboom/dist/kaboom.mjs";

// Inicializa Kaboom
kaboom({
  background: [120,200,255],
});

// -----------------
// Carregar Sprites (raw do GitHub)
// -----------------
loadSprite("bruxo", "https://raw.githubusercontent.com/ABMSantos/a_colheita_do_feiticeiro/main/32189254-pixel-arte-ilustracao-capa-pixelizada-magico-capa-magico-mago-capa-icone-pixelizada-para-a-pixel-arte-jogos-e-icone-para-local-na-rede-internet-e-video-jogo-velho-escola-retro-removebg-.png");
loadSprite("maguinho", "https://raw.githubusercontent.com/ABMSantos/a_colheita_do_feiticeiro/main/guillermo-ruiz-flores-mago-pixel-removebg-preview.png");
loadSprite("fundo", "https://raw.githubusercontent.com/ABMSantos/a_colheita_do_feiticeiro/main/fundo.png");
loadSprite("fireball", "https://raw.githubusercontent.com/ABMSantos/a_colheita_do_feiticeiro/main/pixel-fireball-fireball-pixel-art-115631306101ozjjztwry%20(1).png");
loadSprite("apple", "https://raw.githubusercontent.com/ABMSantos/a_colheita_do_feiticeiro/main/pngtree-pixel-game-fruit-red-apple-png-image_3287470-removebg-preview.png");

// -----------------
// Sons
// -----------------
loadSound("coletar","https://www.soundjay.com/button/sounds/button-3.mp3");
loadSound("hit","https://www.soundjay.com/button/sounds/button-10.mp3");
loadSound("attack","https://www.soundjay.com/button/sounds/button-16.mp3");

// -----------------
// Variáveis Globais
// -----------------
let score = 0, lives = 3, level = 1;
let maguinho, scoreLabel, livesLabel;
let bruxo;
let shootInterval = 1.5;
let fireballSpeed = 200;

// -----------------
// Tela Inicial
// -----------------
function startScreen(){
  add([sprite("fundo"), scale(1), pos(0,0)]);
  const title = add([text("A Colheita do Feiticeiro",{size:32}), pos(width()/2, height()/3), origin("center")]);
  const startBtn = add([text("Pressione ENTER para começar",{size:24}), pos(width()/2, height()/2), origin("center")]);
  onKeyPress("enter", ()=>{
    destroy(title);
    destroy(startBtn);
    startGame();
  });
}

// -----------------
// Tela Game Over
// -----------------
function gameOverScreen(){
  add([rect(width(),height()), color(0,0,0,0.8), pos(0,0), layer("ui")]);
  add([text("GAME OVER",{size:48}), pos(width()/2, height()/3), origin("center"), layer("ui")]);
  add([text("Pressione ENTER para jogar novamente",{size:24}), pos(width()/2, height()/2), origin("center"), layer("ui")]);
  onKeyPress("enter", ()=>{
    destroyAll();
    score=0; lives=3; level=1; shootInterval=1.5; fireballSpeed=200;
    startGame();
  });
}

// -----------------
// Tela Vitória
// -----------------
function victoryScreen(){
  add([rect(width(),height()), color(0,0,0,0.8), pos(0,0), layer("ui")]);
  add([text("VOCÊ VENCEU!",{size:48}), pos(width()/2,height()/3), origin("center"), layer("ui")]);
  add([text("Pressione ENTER para jogar novamente",{size:24}), pos(width()/2,height()/2), origin("center"), layer("ui")]);
  onKeyPress("enter", ()=>{
    destroyAll();
    score=0; lives=3; level=1; shootInterval=1.5; fireballSpeed=200;
    startGame();
  });
}

// -----------------
// Função Principal
// -----------------
function startGame(){
  // Fundo
  add([sprite("fundo"), scale(1), pos(0,0)]);

  // Pontuação e Vidas
  scoreLabel = add([text("Pontos:"+score), pos(12,12), layer("ui")]);
  livesLabel = add([text("Vidas:"+lives), pos(12,36), layer("ui")]);

  // Maguinho
  maguinho = add([sprite("maguinho"), pos(120,120), area(), "player", {speed:200}]);
  let dirX=0, dirY=0;

  onKeyDown("left", ()=>dirX=-1);
  onKeyDown("right", ()=>dirX=1);
  onKeyDown("up", ()=>dirY=-1);
  onKeyDown("down", ()=>dirY=1);
  onKeyRelease(["left","right"], ()=>dirX=0);
  onKeyRelease(["up","down"], ()=>dirY=0);

  maguinho.onUpdate(()=>{ maguinho.move(dirX*maguinho.speed, dirY*maguinho.speed); });

  // Spawn maçã
  function spawnApple(){ add([sprite("apple"), pos(rand(50,width()-50), rand(50,height()-50)), area(), "apple"]); }
  spawnApple();

  maguinho.onCollide("apple",(a)=>{
    destroy(a);
    spawnApple();
    score++; scoreLabel.text="Pontos:"+score;
    play("coletar");
    if(score>=20){ destroyAll(); victoryScreen(); }
  });

  // Bruxo inimigo
  bruxo = add([sprite("bruxo"), pos(width()-100,50), area(), "bruxo"]);
  let dir=1;
  bruxo.onUpdate(()=>{
    bruxo.move(0, dir*50);
    if(bruxo.pos.y>height()-50||bruxo.pos.y<50) dir*=-1;
  });

  // Disparo de bolas de fogo
  function shoot(){
    const f = add([sprite("fireball"), pos(bruxo.pos.x, bruxo.pos.y), area(), "fireball"]);
    play("attack");
    f.onUpdate(()=>{ f.move(-fireballSpeed,0); if(f.pos.x<0) destroy(f); });
  }
  loop(shootInterval, shoot);

  // Colisão com bolas de fogo
  maguinho.onCollide("fireball",(f)=>{
    destroy(f);
    lives--; livesLabel.text="Vidas:"+lives;
    play("hit");
    if(lives<=0){ destroyAll(); gameOverScreen(); }
  });
}

// -----------------
// Começa com tela inicial
// -----------------
startScreen();

</script>
</body>
</html>
